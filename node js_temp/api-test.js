const path = require("path");
const express = require("express");
const app = express();
const port = process.env.PORT || 3000;

// Middleware ููุฑุงุกุฉ ุงูุจูุงูุงุช ูู ุงูู Request
app.use(express.urlencoded({ extended: true })); // ููุฑุงุกุฉ ุจูุงูุงุช ุงูู Form
app.use(express.json()); // ููุฑุงุกุฉ ุจูุงูุงุช ุงูู JSON


// ุชู ูุงุด ุงูููุฏ ุงูุชุงูู ูุฃูู ูุงู ูุนุชูุฏ ุนูู ูุตูููุฉ ุฏุงุฎููุฉุ
// ุงูุขู ูู ุงูุจูุงูุงุช ุชูุฏุงุฑ ุนุจุฑ ุงูููุฏูู ูููู Students.json ููุท.
/*
const Students = [
    { name: 'Ali', dept: 'PD', id: 1 },
    { name: 'Nour', dept: 'SA', id: 2 },
    { name: 'Mona', dept: 'MD', id: 3 },
    { name: 'Sara', dept: 'SAP', id: 4 },
    { name: 'Mostafa', dept: 'EB', id: 5 },
    { name: 'Ahmed', dept: 'GD', id: 6 },
    { name: 'Noha', dept: 'GA', id: 7 },
];
*/

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ๐ Routes - ููุงุท ุงูุงุชุตุงู ุจุงูู API
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ



// โโ Route 1: ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โโ
app.get("/", (req, res) => {
    res.sendFile(path.join(__dirname, "index.html"));
    // ุจูุฑุฌุน ููู HTML ุงูุฑุฆูุณู
});

// โโ Route 2: ุฌูุจ ูู ุงูุทูุงุจ (Read All) โโ
app.get("/api/students", (req, res) => {
    res.json(Students);
    // ุจูุฑุฌุน ูู ุงูุทูุงุจ ูู ุตูุบุฉ JSON
    // ูุซุงู ุงูุงุณุชุฎุฏุงู ูู Postman:
    // Method: GET
    // URL: http://localhost:3000/api/students
});

// โโ Route 3: ุฌูุจ ุทุงูุจ ูุญุฏุฏ ุจุงูู ID (Read One) โโ
app.get("/api/students/:id", (req, res) => {
    const id = parseInt(req.params.id); // ุจูุงุฎุฏ ุงูู id ูู ุงูู URL ููุญููู ูุฑูู
    const student = Students.find((val) => val.id === id); // ุจูุจุญุซ ุนู ุงูุทุงูุจ

    if (student) {
        res.json(student); // ูู ููููุง ุงูุทุงูุจุ ุจูุฑุฌุน ุจูุงูุงุชู
    } else {
        res.status(404).send("student not found"); // ูู ูุด ููุฌูุฏุ ุจูุฑุฌุน ุฑุณุงูุฉ ุฎุทุฃ
    }
    // ูุซุงู ุงูุงุณุชุฎุฏุงู ูู Postman:
    // Method: GET
    // URL: http://localhost:3000/api/students/1
});

// โโ Route 4: ุฅุถุงูุฉ ุทุงูุจ ุฌุฏูุฏ (Create) โโ
app.post("/api/students", (req, res) => {
    const newStudent = req.body; // ุจูุงุฎุฏ ุจูุงูุงุช ุงูุทุงูุจ ุงูุฌุฏูุฏ ูู ุงูู Request Body
    newStudent.id = Students.length + 1; // ุจูุญุท ID ุชููุงุฆู (ุขุฎุฑ ุฑูู + 1)
    Students.push(newStudent); // ุจูุถูู ุงูุทุงูุจ ูููุตูููุฉ
    res.json(newStudent); // ุจูุฑุฌุน ุจูุงูุงุช ุงูุทุงูุจ ุงูุฌุฏูุฏ ูุชุฃููุฏ

    // ูุซุงู ุงูุงุณุชุฎุฏุงู ูู Postman:
    // Method: POST
    // URL: http://localhost:3000/api/students
    // Body (raw - JSON):
    // {
    //   "name": "ูุญูุฏ",
    //   "dept": "CS"
    // }
});

// โโ Route 5: ุชุญุฏูุซ ุจูุงูุงุช ุทุงูุจ ููุฌูุฏ (Update) โโ
app.put("/api/students/:id", (req, res) => {
    const id = parseInt(req.params.id); // ุจูุงุฎุฏ ุงูู ID ูู ุงูู URL
    let idx = Students.findIndex((val) => val.id === id); // ุจูุจุญุซ ุนู ูููุน ุงูุทุงูุจ ูู ุงููุตูููุฉ

    if (idx !== -1) { // ูู ุงูุทุงูุจ ููุฌูุฏ
        // ุจููุฑ ุนูู ูู ุฎุงุตูุฉ ูู ุงูู Body ููุญุฏุซูุง
        for (let key in req.body) {
            Students[idx][key] = req.body[key];
        }
        res.json(Students[idx]); // ุจูุฑุฌุน ุงูุจูุงูุงุช ุงููุญุฏุซุฉ
    } else {
        res.status(404).send("student not found"); // ูู ุงูุทุงูุจ ูุด ููุฌูุฏ
    }

    // ูุซุงู ุงูุงุณุชุฎุฏุงู ูู Postman:
    // Method: PUT
    // URL: http://localhost:3000/api/students/1
    // Body (raw - JSON):
    // {
    //   "name": "ุนูู ุงููุญุฏุซ",
    //   "dept": "IT"
    // }
    // 
    // ููุญูุธุฉ: ูููู ุชุญุฏุซ ุฎุงุตูุฉ ูุงุญุฏุฉ ุจุณ ุฃู ูู ุงูุฎุตุงุฆุต
});

// โโ Route 6: ุญุฐู ุทุงูุจ (Delete) โโ
app.delete("/api/students/:id", (req, res) => {
    const id = parseInt(req.params.id); // ุจูุงุฎุฏ ุงูู ID ูู ุงูู URL
    let idx = Students.findIndex((val) => val.id === id); // ุจูุจุญุซ ุนู ูููุน ุงูุทุงูุจ

    if (idx !== -1) { // ูู ุงูุทุงูุจ ููุฌูุฏ
        let deletedstd = Students.splice(idx, 1); // ุจูุญุฐู ุงูุทุงูุจ ูู ุงููุตูููุฉ
        res.send({
            message: "student deleted successfully",
            student: deletedstd[0]
        }); // ุจูุฑุฌุน ุฑุณุงูุฉ ุงููุฌุงุญ ูุน ุจูุงูุงุช ุงูุทุงูุจ ุงููุญุฐูู
    } else {
        res.status(404).send("student not found"); // ูู ุงูุทุงูุจ ูุด ููุฌูุฏ
    }

    // ูุซุงู ุงูุงุณุชุฎุฏุงู ูู Postman:
    // Method: DELETE
    // URL: http://localhost:3000/api/students/1
    // 
    // โ๏ธ ุชุญุฐูุฑ: ุงูุญุฐู ููุงุฆู ููุงููุด ุทุฑููุฉ ููุชุฑุงุฌุน!
});

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ๐ ุชุดุบูู ุงูุณูุฑูุฑ
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

app.listen(port, () => {
    console.log(`Server running on port ${port}`);
});

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ๐ ุฏููู ุงุณุชุฎุฏุงู Postman ูุงุฎุชุจุงุฑ ุงูู API
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

// โโ 1๏ธโฃ ุชุซุจูุช Postman โโ
// โข ุงูุชุญ ุงููููุน ุงูุฑุณูู: https://www.postman.com/downloads/
// โข ุญูู ุงููุณุฎุฉ ุงูููุงุณุจุฉ ููุธุงู ุงูุชุดุบูู ุจุชุงุนู (Windows, Mac, Linux)
// โข ุงุชุจุน ุชุนูููุงุช ุงูุชุซุจูุช ุนูู ุงููููุน
// โข ุจุนุฏ ุงูุชุซุจูุชุ ุงูุชุญ Postman ูุณุฌู ุฏุฎูู (ุงุฎุชูุงุฑู) ุฃู ุงุณุชุฎุฏูู ูุจุงุดุฑุฉ

// โโ 2๏ธโฃ ุชุดุบูู ุงูุณูุฑูุฑ โโ
// ูู ุงูู Terminal:
// 1. ุชุฃูุฏ ุฅูู ูู ูุฌูุฏ ุงููุดุฑูุน
// 2. ุงูุชุจ: node api-test.js
// 3. ูุงุฒู ุชุดูู: "Server running on port 3000"
// 4. ูุชูููุด ุงูู Terminal ุทูู ูุง ุจุชุฎุชุจุฑ ุงูู API

// โโ 3๏ธโฃ ุฅุนุฏุงุฏ Postman โโ
// โข ุงุฎุชุงุฑ ููุน ุงูู Request (GET, POST, PUT, DELETE) ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ
// โข ุงูุชุจ ุงูู URL ูู ุงูุฎุงูุฉ ุงููุฎุตุตุฉ
// โข ูู ุงูู Request ูู ููุน POST ุฃู PUT:
//   - ุงุถุบุท ุนูู ุชุจููุจ "Body" ุชุญุช ุงูู URL
//   - ุงุฎุชุงุฑ "raw"
//   - ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุนูู ุงููููู ุงุฎุชุงุฑ "JSON"
//   - ุงูุชุจ ุงูุจูุงูุงุช ุจุตูุบุฉ JSON
// โข ุงุถุบุท "Send" ูุฅุฑุณุงู ุงูู Request

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// ๐งช ุฃูุซูุฉ ุนูููุฉ ููุงุฎุชุจุงุฑ
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

// โโ โ GET - ุฌูุจ ูู ุงูุทูุงุจ โโ
// Method: GET
// URL: http://localhost:3000/api/students
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุตูููุฉ JSON ุจูุง 7 ุทูุงุจ

// โโ โ GET - ุฌูุจ ุทุงูุจ ูุญุฏุฏ ุจุงูู ID โโ
// Method: GET
// URL: http://localhost:3000/api/students/1
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุจูุงูุงุช ุงูุทุงูุจ Ali

// โโ โ POST - ุฅุถุงูุฉ ุทุงูุจ ุฌุฏูุฏ โโ
// Method: POST
// URL: http://localhost:3000/api/students
// Body (raw - JSON):
// {
//   "name": "ูุญูุฏ",
//   "dept": "CS"
// }
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุงูุทุงูุจ ุงูุฌุฏูุฏ ูุน id = 8

// โโ โ PUT - ุชุญุฏูุซ ุจูุงูุงุช ุทุงูุจ ููุฌูุฏ โโ
// Method: PUT
// URL: http://localhost:3000/api/students/1
// Body (raw - JSON):
// {
//   "name": "ุนูู ุงููุญุฏุซ",
//   "dept": "IT"
// }
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุจูุงูุงุช ุงูุทุงูุจ ุงููุญุฏุซุฉ

// โโ โ DELETE - ุญุฐู ุทุงูุจ โโ
// Method: DELETE
// URL: http://localhost:3000/api/students/1
// ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุฑุณุงูุฉ ุชุฃููุฏ ุงูุญุฐู ูุน ุจูุงูุงุช ุงูุทุงูุจ ุงููุญุฐูู

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
// โ๏ธ ููุงุญุธุงุช ูููุฉ
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

// ๐ด ุงููุดุงูู ุงูุดุงุฆุนุฉ ูุญููููุง:
// โโโโโโโโโโโโโโโโโโโโโโโโโโ
// 1. "Cannot GET /api/students"
//    โ ุงูุณูุฑูุฑ ูุด ุดุบุงู ุฃู ููู ุฎุทุฃ ูู ุงูู URL
//    โ ุชุฃูุฏ ุฅู ุงูุณูุฑูุฑ ุดุบุงู ูู ุงูู Terminal
//    โ ุชุฃูุฏ ุฅู ุงูู URL ุตุญูุญ ุจุงูุถุจุท

// 2. "EADDRINUSE: address already in use"
//    โ ุงูุจูุฑุช 3000 ูุณุชุฎุฏู ูู ุจุฑูุงูุฌ ุชุงูู
//    โ ุฃููู ุงูุณูุฑูุฑ ุงููุฏูู (Ctrl+C) ูุดุบูู ุชุงูู
//    โ ุฃู ุบูุฑ ุงูุจูุฑุช ูู ุจุฏุงูุฉ ุงูููุฏ

// 3. ุงูุจูุงูุงุช ูุด ุจุชุชุญูุธ ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ
//    โ ุฏู ุทุจูุนู! ุงูุจูุงูุงุช ูุชุฎุฒูุฉ ูู ุงูุฐุงูุฑุฉ (RAM)
//    โ ูู ุนุงูุฒ ุญูุธ ุฏุงุฆูุ ูุงุฒู ุชุณุชุฎุฏู Database ุฒู MongoDB

// 4. "SyntaxError: Unexpected token" ูู Postman
//    โ ุชุฃูุฏ ุฅูู ุงุฎุชุฑุช "JSON" ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูู Body
//    โ ุชุฃูุฏ ุฅู ุงูู JSON ุตุญูุญ (ุงุณุชุฎุฏู ุฃููุงุณ ูุฒุฏูุฌุฉ ููููุงุชูุญ)

// ๐ก ูุตุงุฆุญ ููุชุทููุฑ:
// โโโโโโโโโโโโโโโโโโ
// โข ุงุณุชุฎุฏู Postman Collections ูุญูุธ ูู ุงูู Requests
// โข ุงุฎุชุจุฑ ูู endpoint ุจุนุฏ ูุชุงุจุชู ูุจุงุดุฑุฉ
// โข ุฑุงุฌุน ุงูู console ูู ุงูู Terminal ููุชุงุจุนุฉ ุงูุฃุฎุทุงุก
// โข ุฌุฑุจ ุญุงูุงุช ุงูุฎุทุฃ (ูุซูุงู: ุทูุจ ุทุงูุจ ุบูุฑ ููุฌูุฏ)
// โข ุงุณุชุฎุฏู ูุชุบูุฑุงุช ูู Postman ูุชุณููู ุชุบููุฑ ุงูู URL

// ๐ฏ ุงูุฎุทูุฉ ุงูุชุงููุฉ:
// โโโโโโโโโโโโโโโโโโ
// โข ุชุนูู MongoDB ุฃู PostgreSQL ูุญูุธ ุงูุจูุงูุงุช ุจุดูู ุฏุงุฆู
// โข ุฃุถู Authentication ู Authorization ุจุงุณุชุฎุฏุงู JWT
// โข ุชุนูู Validation ููุจูุงูุงุช ุจุงุณุชุฎุฏุงู ููุชุจุงุช ูุซู Joi ุฃู express-validator
// โข ุญุณูู ุฃูุงู ุงูู API ุจุงุณุชุฎุฏุงู Helmet.js ู CORS
// โข ุชุนูู ุฅูุดุงุก RESTful API ูุชูุงููุฉ ูุน best practices